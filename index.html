<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Junior Pet</title>
  <meta name="description" content="Compre produtos para pets com qualidade e promoÃ§Ãµes imperdÃ­veis. RaÃ§Ãµes, acessÃ³rios, brinquedos e mais para cuidar do seu melhor amigo." />
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/616/616408.png" type="image/png" />
  <style>
    :root {
      --gold: #ffd700;
      --black: #000;
      --bg: #fff;
      --muted: #f9f9f9;
      --border: #ddd;
      --danger: #e74c3c;
      --success: #27ae60;
      --radius: 10px;
      --shadow: 0 6px 24px rgba(0,0,0,0.12);
    }

    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      background: var(--bg);
      padding-top: 110px; /* espaÃ§o para header fixo */
      color: #111;
    }

    header {
      position: fixed; inset: 0 0 auto 0; /* top:0; left:0; right:0 */
      background: linear-gradient(to bottom, var(--gold), var(--black));
      padding: 10px 16px;
      z-index: 10000;
      display: flex; flex-direction: column; align-items: center; gap: 6px;
    }

    .top-row { width: 100%; display: flex; align-items: center; justify-content: space-between; gap: 12px; }

    .logo { height: 60px; }

    nav { display: flex; justify-content: center; gap: 16px; flex-wrap: wrap; }
    nav a { color: var(--gold); font-weight: 700; text-decoration: none; font-size: 1rem; padding: 6px 10px; border-radius: 6px; transition: background-color .3s ease; }
    nav a:hover, nav a:focus { background-color: rgba(255,215,0,.25); outline: none; }

    /* Carrinho */
    .cart-button { position: relative; background: var(--gold); color: var(--black); border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-weight: 800; height: 40px; box-shadow: var(--shadow); }
    .cart-button:focus { outline: 2px solid #fff; outline-offset: 2px; }
    .cart-badge { position: absolute; top: -8px; right: -8px; background: var(--danger); color: #fff; border-radius: 999px; padding: 2px 7px; font-size: 12px; font-weight: 800; min-width: 22px; text-align: center; }

    /* Seletor de bairros (header) */
    .delivery-selection { display: flex; align-items: center; gap: 8px; margin-left: 8px; flex-wrap: wrap; }
    .delivery-selection label { color: var(--gold); font-weight: 800; font-size: 1.05rem; text-shadow: 1px 1px 2px rgba(0,0,0,.35); }
    .delivery-selection select, .delivery-selection output { padding: 6px 8px; border-radius: 6px; border: 1px solid var(--border); background: #fff; }
    #valor-entrega-header { color: var(--gold); font-weight: 800; font-size: 1.05rem; text-shadow: 1px 1px 2px rgba(0,0,0,.35); }

    /* Carrossel */
    .carousel { position: relative; width: min(100%, 860px); height: 320px; overflow: hidden; margin: 6px auto 0; border-radius: var(--radius); box-shadow: var(--shadow); background: #000; }
    .carousel-track { display: flex; width: 100%; height: 100%; transition: transform .8s ease-in-out; }
    .carousel-track img { width: 100%; height: 320px; object-fit: cover; flex-shrink: 0; }
    .carousel-indicators { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; }
    .carousel-indicators button { width: 12px; height: 12px; background-color: rgba(255,255,255,.6); border: none; border-radius: 50%; cursor: pointer; transition: background-color .3s; }
    .carousel-indicators button.active { background-color: var(--gold); }

    /* Filtros */
    .filters { display: flex; justify-content: center; gap: 10px; padding: 12px; flex-wrap: wrap; background: var(--muted); border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); }
    .filters input, .filters select { padding: 10px; border: 1px solid var(--border); border-radius: 8px; min-width: 180px; }

    /* Grid produtos */
    .container { padding: 28px 16px; max-width: 1200px; margin: auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 20px; }
    .product { border: 1px solid var(--border); border-radius: 12px; text-align: center; padding: 12px; background: #fff; cursor: pointer; box-shadow: 0 1px 0 rgba(0,0,0,.02); transition: transform .12s ease; }
    .product:hover { transform: translateY(-2px); }
    .product img { width: 100%; height: auto; max-height: 160px; object-fit: contain; background-color: var(--muted); border-radius: 8px; }
    .product h4 { margin: 10px 0 6px; font-size: 1rem; }
    .product .price { font-weight: 800; margin: 0 0 8px; }
    .product button { background: var(--gold); border: none; padding: 10px; margin-top: 8px; cursor: pointer; border-radius: 8px; font-weight: 800; }

    .product-description { font-size: .9rem; color: #333; margin-top: 8px; text-align: left; }

    /* Modal carrinho */
    #cart-modal { display: none; position: fixed; top: 84px; right: 20px; width: 340px; background: #fff; border: 2px solid var(--gold); border-radius: 12px; box-shadow: 0 0 18px rgba(0,0,0,.35); padding: 14px; z-index: 11000; }
    #cart-modal h3 { margin: 0 0 10px; }
    .cart-item { border-bottom: 1px solid var(--border); padding: 8px 0; display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 8px; }
    .cart-item .name { font-size: .95rem; }
    .qty-controls { display: inline-flex; align-items: center; gap: 6px; background: var(--muted); padding: 4px 6px; border-radius: 999px; }
    .qty-controls button { border: none; background: #fff; border: 1px solid var(--border); width: 26px; height: 26px; border-radius: 50%; cursor: pointer; font-weight: 800; }
    .cart-item .remove { background: var(--danger); color: #fff; border: none; padding: 4px 8px; border-radius: 6px; cursor: pointer; }
    .cart-footer { display: grid; gap: 8px; margin-top: 10px; }
    .totals { display: grid; gap: 4px; font-size: .95rem; }
    .total-line { display: flex; justify-content: space-between; }

    #finalizar-btn { background: var(--danger); color: #fff; border: none; padding: 10px; border-radius: 8px; font-weight: 800; cursor: pointer; }
    #cart-modal button.limpar-carrinho-btn { background: var(--gold); color: #000; border: none; padding: 10px; border-radius: 8px; font-weight: 800; cursor: pointer; }
    #cart-modal button.continuar-comprando-btn { background: var(--success); color: #fff; border: none; padding: 10px; border-radius: 8px; font-weight: 800; cursor: pointer; }

    footer { background: var(--black); color: var(--gold); text-align: center; padding: 16px; margin-top: 40px; }

    /* Form de entrega */
    #formulario-entrega { display: none; position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: #fff; padding: 18px; border: 2px solid var(--gold); border-radius: 12px; z-index: 12000; width: 90%; max-width: 420px; box-shadow: var(--shadow); }
    #formulario-entrega h3 { margin: 0 0 10px; }
    #formulario-entrega input, #formulario-entrega select, #formulario-entrega textarea { width: 100%; margin: 8px 0; padding: 10px; border-radius: 8px; border: 1px solid var(--border); }
    #formulario-entrega button { background: var(--gold); border: none; padding: 10px; width: 100%; margin-top: 10px; border-radius: 8px; font-weight: 800; cursor: pointer; }
    #formulario-entrega .fechar-formulario { background: #ccc; color: #000; }

    /* Modal Produto */
    #produto-modal { display: none; position: fixed; inset: 50% auto auto 50%; transform: translate(-50%, -50%); background: #fff; border: 2px solid var(--gold); border-radius: 12px; max-width: 640px; width: 92%; max-height: 90vh; overflow-y: auto; z-index: 13000; box-shadow: 0 0 15px rgba(0,0,0,.4); padding: 18px; }
    #produto-modal img { width: 100%; max-height: 360px; object-fit: contain; border-radius: 8px; }
    #produto-modal h2 { margin: 12px 0 8px; }
    #produto-modal p { font-size: 1rem; color: #333; }
    #produto-modal button.fechar-modal { margin-top: 12px; background: #ff4d4d; border: none; padding: 10px 12px; border-radius: 8px; color: #fff; cursor: pointer; font-weight: 800; }

    /* Toasts */
    .toast-container { position: fixed; top: 14px; right: 14px; display: grid; gap: 8px; z-index: 14000; }
    .toast { background: #111; color: #fff; padding: 10px 12px; border-radius: 10px; box-shadow: var(--shadow); opacity: 0; transform: translateY(-6px); animation: slideIn .25s forwards; }
    @keyframes slideIn { to { opacity: 1; transform: translateY(0); } }

    /* RESPONSIVE */
    @media (max-width: 900px) {
      .container { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
    }
    @media (max-width: 660px) {
      header { padding: 8px 10px; }
      .logo { height: 44px; }
      body { padding-top: 96px; }
      .carousel { height: 260px; }
      .carousel-track img { height: 260px; }
      #cart-modal { right: 10px; left: 10px; width: auto; }
    }

    /* PreferÃªncia de reduzir movimento: desliga autoplay do carrossel */
    @media (prefers-reduced-motion: reduce) {
      .carousel-track { transition: none; }
    }
  </style>
</head>
<body>
  <header>
    <div class="top-row">
      <img src="img/jr_logo.png" alt="Logo Junior Pet" class="logo" loading="eager" />
      <button class="cart-button" onclick="abrirCarrinho()" aria-label="Abrir carrinho">
        ðŸ›’ R$ <span id="cart-total">0,00</span>
        <span class="cart-badge" id="cart-count" aria-label="Itens no carrinho">0</span>
      </button>
    </div>

    <nav aria-label="NavegaÃ§Ã£o principal">
      <a href="index.html">InÃ­cio</a>
      <a href="index.html">Produtos</a>
      <a href="contato.html">Contato</a>
    </nav>

    <!-- Seletor de bairros no header -->
    <div class="delivery-selection" aria-label="SeleÃ§Ã£o de bairro para entrega">
      <label for="bairro-select">Bairro para entrega:</label>
      <select id="bairro-select" aria-label="Selecionar bairro para entrega">
        <option value="">Selecione</option>
        <!-- opÃ§Ãµes serÃ£o carregadas do bairros.json -->
      </select>
      <span id="valor-entrega-header">Valor entrega: -</span>
    </div>
  </header>

  <div class="carousel" aria-label="PromoÃ§Ãµes">
    <div class="carousel-track" id="carousel-track">
      <img src="/img/promo1.png" alt="PromoÃ§Ã£o raÃ§Ã£o e acessÃ³rios" loading="lazy" />
      <img src="/img/promo2.png" alt="Desconto em brinquedos" loading="lazy" />
      <img src="/img/promo1.png" alt="Ofertas da semana" loading="lazy" />
      <img src="/img/promo2.png" alt="Leve mais por menos" loading="lazy" />
      <img src="/img/promo1.png" alt="Combo especial" loading="lazy" />
    </div>
    <div class="carousel-indicators" id="carousel-indicators" aria-hidden="true"></div>
  </div>

  <div class="filters">
    <select id="categoriaSelect" onchange="filtrarProdutos()" aria-label="Filtrar por categoria">
      <option value="">Todas as categorias</option>
      <option value="RaÃ§Ã£o">RaÃ§Ã£o</option>
      <option value="SaÃºde">SaÃºde</option>
      <option value="AcessÃ³rios">AcessÃ³rios</option>
      <option value="Brinquedos">Brinquedos</option>
    </select>
    <input type="text" id="buscaInput" placeholder="Buscar produto..." aria-label="Buscar produto" />
    <select id="ordenacaoSelect" onchange="filtrarProdutos()" aria-label="Ordenar produtos">
      <option value="">Ordenar por</option>
      <option value="nome-asc">Nome (A-Z)</option>
      <option value="nome-desc">Nome (Z-A)</option>
      <option value="preco-asc">PreÃ§o (Menor para maior)</option>
      <option value="preco-desc">PreÃ§o (Maior para menor)</option>
    </select>
  </div>

  <div class="container" id="produtos-container" aria-live="polite"></div>

  <div id="cart-modal" role="dialog" aria-modal="true" aria-label="Carrinho de compras">
    <h3>Carrinho</h3>
    <div id="cart-items"></div>

    <div class="cart-footer">
      <div class="totals">
        <div class="total-line"><span>Subtotal</span><strong id="subtotal-span">R$ 0,00</strong></div>
        <div class="total-line"><span>Entrega</span><strong id="entrega-span">R$ 0,00</strong></div>
        <div class="total-line"><span>Total</span><strong id="total-span">R$ 0,00</strong></div>
      </div>
      <button id="finalizar-btn" onclick="abrirFormulario()">Finalizar Pedido</button>
      <button class="limpar-carrinho-btn" onclick="limparCarrinho()">Limpar Carrinho</button>
      <button class="continuar-comprando-btn" onclick="fecharCarrinho()">Continuar Comprando</button>
    </div>
  </div>

  <div id="formulario-entrega" role="dialog" aria-modal="true" aria-label="InformaÃ§Ãµes de entrega">
    <h3>InformaÃ§Ãµes de Entrega</h3>
    <input type="text" id="nome" placeholder="Nome completo" required />
    <input type="text" id="endereco" placeholder="EndereÃ§o" required />

    <!-- Agora o bairro no formulÃ¡rio tambÃ©m Ã© um select, sincronizado com o do header -->
    <select id="bairro-form-select" required aria-label="Selecionar bairro no formulÃ¡rio"></select>

    <input type="text" id="referencia" placeholder="Ponto de referÃªncia (opcional)" />
    <select id="pagamento" required>
      <option value="">Forma de pagamento:</option>
      <option value="Dinheiro">Dinheiro</option>
      <option value="Pix">Pix</option>
      <option value="CartÃ£o">CartÃ£o</option>
    </select>
    <textarea id="observacoes" placeholder="ObservaÃ§Ãµes (ex: entregar no portÃ£o, troco para R$100, etc)" rows="3"></textarea>
    <button onclick="enviarPedidoWhatsApp()">Enviar Pedido</button>
    <button onclick="fecharFormulario()" class="fechar-formulario">Voltar</button>
  </div>

  <!-- Modal Produto -->
  <div id="produto-modal" role="dialog" aria-modal="true" aria-label="Detalhes do produto">
    <img src="" alt="Imagem do produto" />
    <h2></h2>
    <p></p>
    <button class="fechar-modal" onclick="fecharModalProduto()">Fechar</button>
  </div>

  <footer>
    <p>&copy; 2025 Junior Pet - Todos os direitos reservados.</p>
  </footer>

  <div class="toast-container" id="toast-container" aria-live="polite"></div>

  <script>
    // Estado
    let produtos = [];
    let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
    let bairros = [];

    // Utilidades
    const BRL = (n) => n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    const toNumber = (v, d = 0) => { const n = Number(v); return Number.isFinite(n) ? n : d; };

    function toast(msg) {
      const c = document.getElementById('toast-container');
      const el = document.createElement('div');
      el.className = 'toast';
      el.textContent = msg;
      c.appendChild(el);
      setTimeout(() => { el.style.opacity = '0'; el.style.transform = 'translateY(-6px)'; }, 2200);
      setTimeout(() => el.remove(), 2600);
    }

    function salvarCarrinho() { localStorage.setItem('carrinho', JSON.stringify(carrinho)); }

    // Carregamento de dados
    async function carregarProdutos() {
      try {
        const response = await fetch('produtos.json', { cache: 'no-store' });
        if (!response.ok) throw new Error('Falha ao carregar produtos');
        produtos = await response.json();
        filtrarProdutos();
      } catch (error) {
        console.error('Erro ao carregar produtos:', error);
        document.getElementById('produtos-container').innerHTML = '<p>NÃ£o foi possÃ­vel carregar os produtos no momento. Tente novamente mais tarde.</p>';
      }
    }

    async function carregarBairros() {
      try {
        const response = await fetch('bairros.json', { cache: 'no-store' });
        if (!response.ok) throw new Error('Falha ao carregar bairros');
        bairros = await response.json();
        preencherBairros();
      } catch (error) {
        console.error('Erro ao carregar bairros:', error);
        toast('Erro ao carregar bairros de entrega.');
      }
    }

    function preencherBairros() {
      const headerSelect = document.getElementById('bairro-select');
      const formSelect = document.getElementById('bairro-form-select');

      const opts = ['<option value="">Selecione</option>']
        .concat(bairros.map(b => `<option value="${b.nome}" data-valor="${b.valor}">${b.nome} - ${BRL(b.valor)}</option>`));

      headerSelect.innerHTML = opts.join('');
      formSelect.innerHTML = opts.join('');

      // restaurar seleÃ§Ã£o anterior
      const saved = localStorage.getItem('bairro-selecionado') || '';
      if (saved) {
        headerSelect.value = saved;
        formSelect.value = saved;
      }

      atualizarValorEntregaHeader();
    }

    function atualizarValorEntregaHeader() {
      const headerSelect = document.getElementById('bairro-select');
      const span = document.getElementById('valor-entrega-header');
      const valor = toNumber(headerSelect.selectedOptions[0]?.dataset.valor, 0);
      span.textContent = valor > 0 ? `Valor entrega: ${BRL(valor)}` : 'Valor entrega: -';
      atualizarCarrinho();
    }

    // Render de produtos
    function renderizarProdutos(lista) {
      const container = document.getElementById('produtos-container');
      container.innerHTML = '';
      if (!Array.isArray(lista) || lista.length === 0) {
        container.innerHTML = '<p>Nenhum produto encontrado.</p>';
        return;
      }
      lista.forEach((p, i) => {
        const imgPath = p.imagem ? `img/mini/${p.imagem}` : `https://via.placeholder.com/300x200?text=${encodeURIComponent(p.nome)}`;
        const el = document.createElement('div');
        el.className = 'product';
        el.innerHTML = `
          <img src="${imgPath}" alt="${p.nome}" loading="lazy" onerror="this.src='https://via.placeholder.com/300x200?text=${encodeURIComponent(p.nome)}'" />
          <h4>${p.nome}</h4>
          <p class="price">${BRL(p.preco)}</p>
          <button onclick="abrirModalProduto(${i})" aria-label="Ver detalhes de ${p.nome}">Ver detalhes</button>
          <button onclick="adicionarCarrinho(${i})" aria-label="Adicionar ${p.nome} ao carrinho">Adicionar</button>
        `;
        container.appendChild(el);
      });
    }

    // Filtros (com debounce na busca)
    let buscaTimer;
    document.addEventListener('input', (e) => {
      if (e.target.id === 'buscaInput') {
        clearTimeout(buscaTimer);
        buscaTimer = setTimeout(filtrarProdutos, 200);
      }
    });

    function filtrarProdutos() {
      const categoria = document.getElementById('categoriaSelect').value.toLowerCase();
      const busca = document.getElementById('buscaInput').value.toLowerCase().trim();
      const ordenacao = document.getElementById('ordenacaoSelect').value;

      let filtrados = (produtos || []).filter(p => {
        const matchCategoria = (categoria === '' || (p.categoria||'').toLowerCase() === categoria);
        const termo = `${(p.nome||'').toLowerCase()} ${(p.descricao||'').toLowerCase()}`;
        const matchBusca = busca === '' || termo.includes(busca);
        return matchCategoria && matchBusca;
      });

      if (ordenacao === 'nome-asc') filtrados.sort((a,b) => a.nome.localeCompare(b.nome));
      else if (ordenacao === 'nome-desc') filtrados.sort((a,b) => b.nome.localeCompare(a.nome));
      else if (ordenacao === 'preco-asc') filtrados.sort((a,b) => a.preco - b.preco);
      else if (ordenacao === 'preco-desc') filtrados.sort((a,b) => b.preco - a.preco);

      renderizarProdutos(filtrados);
    }

    // Carrossel
    const track = document.getElementById('carousel-track');
    const indicatorsContainer = document.getElementById('carousel-indicators');
    let index = 0; let interval; let autoplay = !matchMedia('(prefers-reduced-motion: reduce)').matches;

    function initCarousel() {
      const totalSlides = track.children.length;
      indicatorsContainer.innerHTML = '';
      for (let i = 0; i < totalSlides; i++) {
        const dot = document.createElement('button');
        dot.addEventListener('click', () => { index = i; updateCarousel(); resetInterval(); });
        indicatorsContainer.appendChild(dot);
      }
      indicatorsContainer.children[0]?.classList.add('active');
      if (autoplay) resetInterval();
    }

    function updateCarousel() {
      const totalSlides = track.children.length;
      track.style.transform = `translateX(-${index * 100}%)`;
      Array.from(indicatorsContainer.children).forEach(d => d.classList.remove('active'));
      indicatorsContainer.children[index]?.classList.add('active');
      if (index >= totalSlides - 1) index = -1; // prepara looping
    }

    function moveCarousel() { index = index + 1; updateCarousel(); }
    function resetInterval() { clearInterval(interval); if (autoplay) interval = setInterval(moveCarousel, 3000); }

    // Carrinho
    function adicionarCarrinho(idx) {
      const produto = produtos[idx];
      if (!produto) return;
      const item = carrinho.find(it => it.produto.nome === produto.nome);
      if (item) item.quantidade++;
      else carrinho.push({ produto, quantidade: 1 });
      toast(`${produto.nome} adicionado ao carrinho!`);
      salvarCarrinho();
      atualizarCarrinho();
    }

    function alterarQuantidade(index, delta) {
      const item = carrinho[index];
      if (!item) return;
      item.quantidade += delta;
      if (item.quantidade <= 0) carrinho.splice(index, 1);
      salvarCarrinho();
      atualizarCarrinho();
    }

    function removerItem(index) { carrinho.splice(index, 1); salvarCarrinho(); atualizarCarrinho(); }

    function atualizarCarrinho() {
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      const cartCount = document.getElementById('cart-count');
      const headerSelect = document.getElementById('bairro-select');

      cartItems.innerHTML = '';
      let subtotal = 0; let count = 0;

      carrinho.forEach((item, index) => {
        subtotal += item.produto.preco * item.quantidade;
        count += item.quantidade;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <div>
            <div class="name">${item.produto.nome}</div>
            <div class="qty-controls" aria-label="Controles de quantidade">
              <button aria-label="Diminuir" onclick="alterarQuantidade(${index}, -1)">-</button>
              <span>x${item.quantidade}</span>
              <button aria-label="Aumentar" onclick="alterarQuantidade(${index}, 1)">+</button>
            </div>
          </div>
          <div>
            <div style="text-align:right; font-weight:700;">${BRL(item.produto.preco * item.quantidade)}</div>
            <button class="remove" aria-label="Remover item" onclick="removerItem(${index})">Remover</button>
          </div>
        `;
        cartItems.appendChild(div);
      });

      const valorEntrega = toNumber(headerSelect.selectedOptions[0]?.dataset.valor, 0);
      const totalFinal = subtotal + valorEntrega;

      // Atualiza totais do modal
      document.getElementById('subtotal-span').textContent = BRL(subtotal);
      document.getElementById('entrega-span').textContent = BRL(valorEntrega);
      document.getElementById('total-span').textContent = BRL(totalFinal);

      // Atualiza botÃ£o fixo
      cartTotal.textContent = BRL(totalFinal).replace('R$\u00a0',''); // mostra sÃ³ nÃºmero ao lado do Ã­cone
      cartCount.textContent = count;

      if (carrinho.length === 0) {
        cartItems.innerHTML = '<p>Carrinho vazio.</p>';
      }
    }

    function abrirCarrinho() { document.getElementById('cart-modal').style.display = 'block'; }
    function fecharCarrinho() { document.getElementById('cart-modal').style.display = 'none'; }

    function limparCarrinho() {
      if (confirm('Deseja realmente limpar o carrinho?')) {
        carrinho = []; salvarCarrinho(); atualizarCarrinho(); fecharCarrinho();
      }
    }

    function abrirFormulario() {
      fecharCarrinho();
      // sincroniza seleÃ§Ã£o de bairro no formulÃ¡rio
      const headerSelect = document.getElementById('bairro-select');
      const formSelect = document.getElementById('bairro-form-select');
      formSelect.value = headerSelect.value;
      document.getElementById('formulario-entrega').style.display = 'block';
    }
    function fecharFormulario() { document.getElementById('formulario-entrega').style.display = 'none'; }

    function enviarPedidoWhatsApp() {
      const nome = document.getElementById('nome').value.trim();
      const endereco = document.getElementById('endereco').value.trim();
      const bairro = document.getElementById('bairro-form-select').value.trim();
      const referencia = document.getElementById('referencia').value.trim();
      const pagamento = document.getElementById('pagamento').value;
      const observacoes = document.getElementById('observacoes').value;

      if (!nome || !endereco || !bairro || !pagamento) { toast('Por favor, preencha todos os campos obrigatÃ³rios.'); return; }
      if (carrinho.length === 0) { toast('Seu carrinho estÃ¡ vazio.'); return; }

      const valorEntrega = toNumber(bairros.find(b => b.nome === bairro)?.valor, 0);

      let mensagem = `OlÃ¡, quero fazer o pedido:%0A%0A`;
      carrinho.forEach(item => {
        mensagem += `- ${item.produto.nome} (x${item.quantidade}) - ${BRL(item.produto.preco * item.quantidade)}%0A`;
      });

      let total = carrinho.reduce((acc, item) => acc + item.produto.preco * item.quantidade, 0) + valorEntrega;
      mensagem += `%0AValor entrega: ${BRL(valorEntrega)}`;
      mensagem += `%0ATotal: ${BRL(total)}%0A%0A`;
      mensagem += `Nome: ${nome}%0AEndereÃ§o: ${endereco}%0ABairro: ${bairro}%0APonto de referÃªncia: ${referencia}%0AForma de Pagamento: ${pagamento}%0AObservaÃ§Ãµes: ${encodeURIComponent(observacoes)}`;

      const urlWhatsapp = `https://wa.me/5522997407901?text=${mensagem}`;
      const janela = window.open(urlWhatsapp, '_blank');
      if (!janela) { alert('NÃ£o foi possÃ­vel abrir o WhatsApp. Verifique seu bloqueador de pop-ups.'); }

      fecharFormulario();
      carrinho = []; salvarCarrinho(); atualizarCarrinho();
    }

    // Modal Produto
    function abrirModalProduto(index) {
      const produto = produtos[index];
      if (!produto) return;
      const modal = document.getElementById('produto-modal');
      const src = produto.imagem ? `img/${produto.imagem}` : `https://via.placeholder.com/600x400?text=${encodeURIComponent(produto.nome)}`;
      const img = modal.querySelector('img');
      img.src = src; img.alt = produto.nome; img.loading = 'lazy';
      modal.querySelector('h2').textContent = produto.nome;
      modal.querySelector('p').textContent = produto.descricao || '';
      modal.style.display = 'block';
    }
    function fecharModalProduto() { document.getElementById('produto-modal').style.display = 'none'; }

    // Eventos
    document.addEventListener('DOMContentLoaded', () => {
      carregarProdutos();
      carregarBairros();
      initCarousel();

      const headerSelect = document.getElementById('bairro-select');
      const valorEntregaSpan = document.getElementById('valor-entrega-header');

      headerSelect.addEventListener('change', function () {
        const selected = this.value || '';
        localStorage.setItem('bairro-selecionado', selected);
        atualizarValorEntregaHeader();
      });

      // Atualiza UI do carrinho ao iniciar
      atualizarCarrinho();
    });
  </script>
</body>
</html>
